<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>multi-swap-hub</title>
    <meta name="description" content="Lovable Generated Project" />
    <meta name="author" content="Lovable" />

    <meta property="og:title" content="multi-swap-hub" />
    <meta property="og:description" content="Lovable Generated Project" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lovable_dev" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
    
    <!-- CRITICAL: Ultra-early wallet extension polyfills -->
    <script>
      // Execute IMMEDIATELY - before any extension code
      (function() {
        'use strict';
        
        // 1. Global namespace setup
        if (typeof global === 'undefined') {
          globalThis.global = globalThis;
        }
        
        // 2. Navigator object polyfill
        if (typeof navigator === 'undefined') {
          globalThis.navigator = {
            userAgent: 'Mozilla/5.0 (compatible; Wallet-Polyfill)',
            platform: 'Web',
            language: 'en-US'
          };
        }
        
        // 3. Service Worker API - CRITICAL for wallet extensions
        var serviceWorkerAPI = {
          register: function() { 
            return Promise.resolve({
              scope: '/',
              unregister: function() { return Promise.resolve(true); },
              update: function() { return Promise.resolve(); },
              addEventListener: function() {},
              removeEventListener: function() {}
            }); 
          },
          getRegistration: function() { return Promise.resolve(null); },
          getRegistrations: function() { return Promise.resolve([]); },
          ready: Promise.resolve({ active: { state: 'activated' } }),
          controller: null,
          addEventListener: function() {},
          removeEventListener: function() {}
        };
        
        // Force-define serviceWorker
        try {
          if (navigator && !navigator.serviceWorker) {
            Object.defineProperty(navigator, 'serviceWorker', {
              value: serviceWorkerAPI,
              writable: false,
              configurable: false,
              enumerable: true
            });
          }
        } catch (e) {
          if (navigator) navigator.serviceWorker = serviceWorkerAPI;
        }
        
        // 4. Chrome Extension APIs
        var chromeAPI = {
          runtime: {
            id: 'wallet-polyfill',
            register: function() { return Promise.resolve(); },
            onMessage: {
              addListener: function() {},
              removeListener: function() {},
              hasListener: function() { return false; }
            },
            sendMessage: function() { return Promise.resolve(); },
            connect: function() {
              return {
                postMessage: function() {},
                disconnect: function() {},
                onMessage: { addListener: function() {} },
                onDisconnect: { addListener: function() {} }
              };
            }
          },
          storage: {
            local: {
              get: function() { return Promise.resolve({}); },
              set: function() { return Promise.resolve(); },
              remove: function() { return Promise.resolve(); }
            }
          },
          tabs: { query: function() { return Promise.resolve([]); } }
        };
        
        if (typeof chrome === 'undefined') {
          globalThis.chrome = chromeAPI;
          if (typeof window !== 'undefined') window.chrome = chromeAPI;
        }
        
        // 5. Web3 Provider APIs
        var web3API = {
          register: function() { return Promise.resolve(); },
          isMetaMask: false,
          isPhantom: false,
          request: function() { return Promise.reject(new Error('No wallet')); },
          on: function() {},
          removeListener: function() {}
        };
        
        // Apply to window for wallet extensions
        if (typeof window !== 'undefined') {
          if (!window.ethereum) window.ethereum = web3API;
          if (!window.solana) window.solana = web3API;
          if (!window.phantom) window.phantom = { solana: web3API };
          if (!window.coinbase) window.coinbase = web3API;
        }
        
        // 6. Global APIs that extensions destructure
        var globalAPIs = {
          register: function() { return Promise.resolve(); },
          unregister: function() { return Promise.resolve(); },
          getRegistration: function() { return Promise.resolve(null); }
        };
        
        // Apply globally
        for (var key in globalAPIs) {
          if (typeof globalThis[key] === 'undefined') {
            globalThis[key] = globalAPIs[key];
          }
          if (typeof window !== 'undefined' && typeof window[key] === 'undefined') {
            window[key] = globalAPIs[key];
          }
        }
        
        // 7. Process polyfill (mutable for Vite)
        if (typeof process === 'undefined') {
          var processAPI = {
            env: {},
            version: '16.0.0',
            platform: 'browser',
            nextTick: function(fn) { setTimeout(fn, 0); }
          };
          globalThis.process = processAPI;
          if (typeof window !== 'undefined') window.process = processAPI;
        }
        
        // 8. Buffer polyfill with all methods
        if (typeof Buffer === 'undefined') {
          var BufferAPI = {
            from: function(data, encoding) {
              if (typeof data === 'string') return new TextEncoder().encode(data);
              if (Array.isArray(data)) return new Uint8Array(data);
              return data instanceof Uint8Array ? data : new Uint8Array(data);
            },
            isBuffer: function(obj) { return obj instanceof Uint8Array; },
            alloc: function(size, fill) {
              var buf = new Uint8Array(size);
              if (fill !== undefined) buf.fill(typeof fill === 'number' ? fill : 0);
              return buf;
            },
            allocUnsafe: function(size) { return new Uint8Array(size); },
            concat: function(buffers, totalLength) {
              if (!Array.isArray(buffers)) return new Uint8Array(0);
              if (!totalLength) totalLength = buffers.reduce(function(sum, buf) { return sum + buf.length; }, 0);
              var result = new Uint8Array(totalLength);
              var offset = 0;
              for (var i = 0; i < buffers.length; i++) {
                result.set(buffers[i], offset);
                offset += buffers[i].length;
              }
              return result;
            }
          };
          globalThis.Buffer = BufferAPI;
          if (typeof window !== 'undefined') window.Buffer = BufferAPI;
        }
        
      })();
    </script>
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>